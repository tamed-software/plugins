jQuery(document).ready(function(R){var af=R(window),j=R(document),H=R("body"),D=R("#mailster_iframe"),Z=R("#template-wrap"),ad,s,C=R("#mailster_template .inside"),f=!!R("#mailster_disabled").val(),W=R("#title"),O=R("#mailster_subject"),ab=R("#mailster_preheader"),Y=R("#content"),b=R("#excerpt"),ac=R("#modules"),ae=R("#plain-text-wrap"),N=R("#html-wrap"),u=R("#head"),y=R("#optionbar"),J=[],X=R("#post_ID").val(),ao=0,c=R("#clickmap-stats"),V=R('[name^="mailster_data"]'),G=R("#mailster_nonce").val(),I=false,aj,F,t,K,h,m,M,ag=R("html,body"),g="WebkitAppearance" in document.documentElement.style,l=(/firefox/i).test(navigator.userAgent),k=(/msie|trident/i).test(navigator.userAgent),A,p,al=false,z="ontouchstart" in document.documentElement,o=typeof tinymce=="object",P,E={mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true};function ak(){a("disable");ah();s=(D[0].contentWindow||D[0].contentDocument);if(s.document){s=s.document}aa();var ar=setTimeout(function(){if(!I){D.trigger("load")}},5000);window.Mailster=window.Mailster||{refresh:function(){a("refresh")},save:function(){a("save")},trigger:a,autosave:""};D.on("load",function(){if(I){return false}if(!f){if(!h){h=new ai()}if(!M){M=new aq()}if(!K){K=new ap()}window.Mailster.editbar=M}else{}a("enable");I=true;clearInterval(ar);ad=D.contents().find("body");if(f){window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;ad.on("click","a",function(){window.open(this.href);return false})}else{}a("refresh");if(!Y.val()){a("save")}R("#normal-sortables").on("sortupdate",function(at,au){a("resize")});Z.removeClass("load");J.push(B())});af.on("resize.mailster",function(){a("refresh")});if(/post_status=autoresponder/.test(R("#referredby").val())||/post_status=autoresponder/.test(location.search)){R("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(k){H.addClass("ie")}if(z){H.addClass("touch")}}function aa(){j.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){a("resize")});R("#mailster_submitdiv").on("change","#use_pwd",function(){R("#password-wrap").slideToggle(200).find("input").focus().select();R("#post_password").prop("disabled",!R(this).is(":checked"))});if(!f){j.on("heartbeat-send",function(at,ar){if(ar&&ar.wp_autosave){ar.wp_autosave["content"]=i();ar.wp_autosave["excerpt"]=b.val();ar.mailsterdata=V.serialize()}}).on("click",".restore-backup",function(at,ar){var ar=wp.autosave.local.getSavedPostData();U(ar.content);W.val(ar.post_title);return false}).on("change",".dynamic_embed_options_taxonomy",function(){var ar=R(this),at=ar.val();ar.parent().find(".button").remove();if(at!=-1){if(ar.parent().find("select").length<ar.find("option").length-1){R(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(ar)}}else{ar.parent().html("").append(ar)}return false}).on("click",".add_embed_options_taxonomy",function(){var at=R(this),ar=at.prev().clone();ar.insertBefore(at).val("-1");R("<span> "+mailsterL10n.or+" </span>").insertBefore(ar);at.remove();return false});W.on("change",function(){if(!O.val()){O.val(R(this).val())}});R("form#post").on("submit",function(){if(al){return false}a("save")});R("#mailster_submitdiv").on("click",".sendnow-button",function(){if(!confirm(mailsterL10n.send_now)){return false}});R("#mailster_delivery").on("change","input.timezone",function(){R(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){R(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var ar=R(this).parent().parent().parent();ar.find("span").addClass("disabled")}).on("change","#autoresponder-post_type",function(){var ar=R("#autoresponder-taxonomies");ar.find("select").prop("disabled",true);S("get_post_term_dropdown",{labels:false,names:true,posttype:R(this).val()},function(at){if(at.success){ar.html(at.html)}},function(at,av,au){loader(false)})}).on("click",".category-tabs a",function(){var at=R(this),ar=at.attr("href");R("#mailster_delivery").find(".tabs-panel").hide();R("#mailster_delivery").find(".tabs").removeClass("tabs");at.parent().addClass("tabs");R(ar).show();R("#mailster_is_autoresponder").val((ar=="#autoresponder")?1:"");return false}).on("click",".mailster_sendtest",function(){var at=R(this),ar=R("#delivery-ajax-loading").css("display","inline");at.prop("disabled",true);a("save");S("send_test",{formdata:R("#post").serialize(),to:R("#mailster_testmail").val()?R("#mailster_testmail").val():R("#mailster_testmail").attr("placeholder"),content:Y.val(),head:u.val(),plaintext:b.val()},function(au){ar.hide();at.prop("disabled",false);var av=R('<div class="'+((!au.success)?"error":"updated")+'"><p>'+au.msg+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})},function(au,ax,av){ar.hide();at.prop("disabled",false);var aw=R('<div class="error"><p>'+ax+" "+au.status+": "+av+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})})}).on("change","#mailster_data_active",function(){(R(this).is(":checked"))?R(".active_wrap").addClass("disabled"):R(".active_wrap").removeClass("disabled");R(".deliverydate, .deliverytime").prop("disabled",!R(this).is(":checked"))}).on("change","#mailster_data_autoresponder_active",function(){(R(this).is(":checked"))?R(".autoresponder_active_wrap").addClass("disabled"):R(".autoresponder_active_wrap").removeClass("disabled")}).on("click",".mailster_spamscore",function(){var aw=R(this),ar=R("#delivery-ajax-loading").css("display","inline"),av=R("#spam_score_progress").removeClass("spam-score").slideDown(200),au=av.find(".bar");aw.prop("disabled",true);R(".score").html("");a("save");au.css("width","20%");S("send_test",{spamtest:true,formdata:R("#post").serialize(),to:R("#mailster_testmail").val()?R("#mailster_testmail").val():R("#mailster_testmail").attr("placeholder"),content:Y.val(),head:u.val(),plaintext:b.val()},function(ax){if(ax.success){au.css("width","40%");at(ax.id,1)}else{ar.hide();av.slideUp(200);var ay=R('<div class="error"><p>'+ax.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})}},function(ax,aA,ay){ar.hide();aw.prop("disabled",false);var az=R('<div class="error"><p>'+aA+" "+ax.status+": "+ay+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){az.remove()})});function at(ay,ax){S("check_spam_score",{ID:ay},function(aA){if(aA.score){ar.hide();aw.prop("disabled",false);av.addClass("spam-score");au.css("width",(parseFloat(aA.score)*10)+"%");R(".score").html("<strong>"+x(mailsterL10n.yourscore,aA.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((aA.score/10)*mailsterL10n.yourscores.length)])}else{if(ax<=5&&!aA.abort){var az=(ax*10)+50;au.css("width",(az)+"%");setTimeout(function(){at(ay,++ax)},ax*400)}else{ar.hide();aw.prop("disabled",false);au.css("width","100%");av.slideUp(200);var aB=R('<div class="error"><p>'+aA.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove();au.css("width",0)})}}},function(az,aC,aA){ar.hide();aw.prop("disabled",false);var aB=R('<div class="error"><p>'+aC+" "+az.status+": "+aA+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})})}}).on("blur","input.deliverytime",function(){j.unbind(".mailster_deliverytime")}).on("focus, click","input.deliverytime",function(aw){var ax=R(this),at=R(this)[0],ar=ax.offset().left,ay=0,av=0,au=2;if(aw.clientX-ar>23){ay=1,av=3,au=5}j.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(az){if(az.keyCode==9){return(ay=!ay)?!p(at,3,5):(az.shiftKey)?!p(at,0,2):true}}).on("keyup.mailster_deliverytime",function(az){if(ax.val().length==1){ax.val(ax.val()+":00");p(at,1,1)}if(document.activeElement.selectionStart==2){if(ax.val().substr(0,2)>23){ax.trigger("change");return false}p(at,3,5)}});p(at,av,au)}).on("change","input.deliverytime",function(){var at=R(this),au=at.val(),ar;at.addClass("inactive");if(!/^\d+:\d+$/.test(au)){if(au.length==1){au="0"+au+":00"}else{if(au.length==2){au=au+":00"}else{if(au.length==3){au=au.substr(0,2)+":"+au.substr(2,3)+"0"}else{if(au.length==4){au=au.substr(0,2)+":"+au.substr(2,4)}}}}}ar=au.split(":");if(!/\d\d:\d\d$/.test(au)&&au!=""||ar[0]>23||ar[1]>59){at.val("00:00").focus();p(at[0],0,2)}else{at.val(au)}}).on("change","#mailster_autoresponder_action",function(){R("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+R(this).val())}).on("change","#time_extra",function(){R("#autoresponderfield-mailster_timebased_advanced").slideToggle()}).on("click",".mailster_autoresponder_timebased-end-schedule",function(){(R(this).is(":checked"))?R(".mailster_autoresponder_timebased-end-schedule-field").slideDown():R(".mailster_autoresponder_timebased-end-schedule-field").slideUp()}).on("change",".mailster-action-hooks",function(){var ar=R(this).val();R(".mailster-action-hook").val(ar);if(!ar){R(".mailster-action-hook").focus()}}).on("change",".mailster-action-hook",function(){var ar=R(this).val();if(!R(".mailster-action-hooks option[value='"+ar+"']").length){R(".mailster-action-hooks").append("<option>"+ar+"</option>")}R(".mailster-action-hooks").val(ar)}).on("click",".mailster-total",function(){a("updateCount")}).on("change","#list_extra",function(){if(R(this).is(":checked")){R("#mailster_list_advanced").slideDown()}else{R("#mailster_list_advanced").slideUp()}R("#list-checkboxes").find("input.list").eq(0).trigger("change")}).on("focus","input.datepicker",function(){R(this).removeClass("inactive").trigger("click")}).on("blur","input.datepicker",function(){R(".deliverydate").html(R(this).val());R(this).addClass("inactive")}).on("change","input.datepicker",function(){});R("#mailster_details").on("click",".default-value",function(){var ar=R(this);R("#"+ar.data("for")).val(ar.data("value"))});R("input.color").wpColorPicker({color:true,width:250,mode:"hsl",palettes:R(".colors").data("original-colors"),change:function(ar,at){R(this).val(at.color.toString()).trigger("change")},clear:function(ar,at){}});R(".mailster-preview-iframe").on("load",function(){var au=R(this),at=au.contents(),ar=at.find("body");ar.on("click","a",function(){var av=R(this).attr("href");if(av&&av!="#"){window.open(av)}return false})});if(typeof jQuery.datepicker=="object"){R("#mailster_delivery").find("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var ar=R(this).datepicker("getDate");R(".deliverydate").html(R(this).val())}});R("input.datepicker.nolimit").datepicker("option","minDate",null)}else{R("#mailster_delivery").find("input.datepicker").prop("readonly",false)}R("#mailster_attachments").on("click",".delete-attachment",function(ar){ar.preventDefault();R(this).parent().remove()}).on("click",".add-attachment",function(ar){ar.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var au=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),at=R(".mailster-attachment").eq(0).clone();at.find("img").attr("src",au.icon);at.find(".mailster-attachment-label").html(au.filename);at.find("input").attr("name","mailster_data[attachments][]").val(au.id);at.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});R("#mailster_receivers").on("change","input.list",function(){a("updateCount")}).on("change","#all_lists",function(){R("#list-checkboxes").find("input.list").prop("checked",R(this).is(":checked"));a("updateCount")}).on("change","#ignore_lists",function(){var ar=R(this).is(":checked");R("#list-checkboxes").each(function(){(ar)?R(this).slideUp(200):R(this).slideDown(200)}).find("input.list");a("updateCount")}).on("click",".edit-conditions",function(){tb_show(mailsterL10n.edit_conditions,"#TB_inline?x=1&width=720&height=520&inlineId=receivers-dialog",null);return false}).on("click",".remove-conditions",function(){if(confirm(mailsterL10n.remove_conditions)){R("#receivers-dialog").find(".mailster-conditions-wrap").empty();a("updateCount")}return false}).on("click",".mailster-total",function(){a("updateCount")});R(".close-conditions").on("click",tb_remove);R("#mailster_options").on("click",".wp-color-result",function(){R(this).closest("li.mailster-color").addClass("open")}).on("click","a.default-value",function(){var at=R(this).prev().find("input"),ar=at.data("default");at.wpColorPicker("color",ar);return false}).on("click","ul.colorschema",function(){var at=R("#mailster_options").find("input.color"),ar=R(this).find("li.colorschema-field");a("disable");R.each(ar,function(av){var au=ar.eq(av).data("hex");at.eq(av).wpColorPicker("color",au)});a("enable")}).on("click","a.savecolorschema",function(){var at=R.map(R("#mailster_options").find(".color"),function(au){return R(au).val()});var ar=R("#colorschema-ajax-loading").css("display","inline");S("save_color_schema",{template:R("#mailster_template_name").val(),colors:at},function(au){ar.hide();if(au.success){R(".colorschema").last().after(R(au.html).hide().fadeIn())}},function(au,aw,av){ar.hide()})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var at=R(this).parent().parent();var ar=R("#colorschema-ajax-loading").css({display:"inline"});S("delete_color_schema",{template:R("#mailster_template_name").val(),hash:at.data("hash")},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide()})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var at=R(".colorschema.custom");var ar=R("#colorschema-ajax-loading").css({display:"inline"});S("delete_color_schema_all",{template:R("#mailster_template_name").val()},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide()})}return false}).on("change","#mailster_version",function(){var ar=R(this).val();L(ar)}).on("change","input.color",function(){var at=R(this);var ar=at.data("value");Q(ar,at.val(),at)});R("#mailster_template").on("click","a.getplaintext",function(){var ar=b.val();b.val(mailsterL10n.loading);S("get_plaintext",{html:i()},function(at){b.val(at)},function(at,av,au){b.val(ar)},"HTML")}).on("change","#plaintext",function(){var ar=R(this).is(":checked");b.prop("disabled",ar)[ar?"addClass":"removeClass"]("disabled")})}else{if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}R("#mailster_details").on("click","#show_recipients",function(){var au=R(this),at=R("#recipients-list"),ar=R("#recipients-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_recipients",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_clicks",function(){var au=R(this),at=R("#clicks-list"),ar=R("#clicks-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_clicks",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_environment",function(){var au=R(this),at=R("#environment-list"),ar=R("#environment-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_environment",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_geolocation",function(){var au=R(this),at=R("#geolocation-list"),ar=R("#geolocation-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_geolocation",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100,function(){var az,aA,aC={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ay;var aE;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aE=new google.visualization.GeoChart(document.getElementById("countries_map"));az=aA=google.visualization.arrayToDataTable(av.countrydata);if(location.hash&&(ay=location.hash.match(/region=([A-Z]{2})/))){aw(ay[1])}else{aD()}google.visualization.events.addListener(aE,"regionClick",aw)}});R("a.zoomout").on("click",function(){ax();return false});R("#countries_table").find("tbody").find("tr").on("click",function(){var aF=R(this).data("code");(aF=="unknown"||!aF)?ax():aw(aF);return false});function ax(){var aF={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};az=aA;aD(aF);R("#countries_table").find("tr").removeClass("wp-ui-highlight");R("#mapinfo").hide();location.hash="#region="}function aw(aG){var aF={},aH=aG.region?aG.region:aG,aI;if(aH.match(/-/)){return false}aF.region=aH;(av.unknown_cities[aH])?R("#mapinfo").show().html("+ "+av.unknown_cities[aH]+" unknown locations"):R("#mapinfo").hide();aI=av.geodata[aH]?av.geodata[aH]:[];aF.resolution="provinces";aF.displayMode="markers";aF.dataMode="markers";aF.colors=["#4EBEE9","#2BB3E7"];az=new google.visualization.DataTable();az.addColumn("number","Lat");az.addColumn("number","Long");az.addColumn("string","tooltip");az.addColumn("number","Value");az.addColumn({type:"string",role:"tooltip"});az.addRows(aI);R("#countries_table").find("tr").removeClass("wp-ui-highlight");R("#country-row-"+aH).addClass("wp-ui-highlight");location.hash="#region="+aH;aD(aF)}function aD(aF){aF=R.extend(aC,aF);aE.draw(az,aF);R("a.zoomout").css({visibility:(aC.region!="world"?"visible":"hidden")})}function aB(aG){var aF=aG;R.each(regions,function(aH,aI){if(R.inArray(aG,aI)!=-1){aF=aH}});return aF}})},function(av,ax,aw){ar.hide()});return false}).on("click","#show_errors",function(){var au=R(this),at=R("#error-list"),ar=R("#error-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_errors",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_countries",function(){R("#countries_wrap").toggle();return false});R("#mailster_details").on("click",".load-more-receivers",function(){var ax=R(this),aw=ax.data("page"),au=ax.data("types"),av=ax.data("orderby"),at=ax.data("order"),ar=ax.next().css({display:"inline"});S("get_recipients_page",{id:X,types:au,page:aw,orderby:av,order:at},function(ay){ar.hide();if(ay.success){ax.parent().parent().replaceWith(ay.html)}},function(ay,aA,az){detailbox.removeClass("loading")});return false}).on("click",".recipients-limit",function(ar){if(ar.altKey){R("input.recipients-limit").prop("checked",false);R(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(av){var ax=R("#recipients-list"),at=R("#recipients-ajax-loading"),au=R("input.recipients-limit:checked").map(function(){return this.value}).get(),aw=R("select.recipients-order").val(),ar=R("a.recipients-order").hasClass("asc")?"ASC":"DESC";at.css({display:"inline"});R("input.recipients-limit").prop("disabled",true);S("get_recipients",{id:X,types:au.join(","),orderby:aw,order:ar},function(ay){at.hide();R("input.recipients-limit").prop("disabled",false);ax.html(ay.html).slideDown(100)},function(ay,aA,az){at.hide()});return false}).on("click","a.recipients-order",function(){R(this).toggleClass("asc");R("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var ar=R(this),au=ar.data("id"),at=R("#receiver-detail-"+au).show();ar.parent().addClass("loading").parent().addClass("expanded");S("get_recipient_detail",{id:au,campaignid:X},function(av){ar.parent().removeClass("loading");if(av.success){at.find("div.receiver-detail-body").html(av.html).slideDown(100)}},function(av,ax,aw){at.removeClass("loading")});return false}).on("click","#stats label",function(){R("#recipients-list").find("input").prop("checked",false).filter("input."+R(this).attr("class")).prop("checked",true).trigger("change")});C.on("mouseenter","a.clickbadge",function(){var ax=R(this),ar=ax.position(),aw=ax.data("p"),av=ax.data("link"),at=ax.data("clicks"),au=ax.data("total");c.find(".piechart").data("easyPieChart").update(aw);c.find(".link").html(av);c.find(".clicks").html(at);c.find(".total").html(au);c.stop().fadeIn(100).css({top:ar.top-85,left:ar.left-(c.width()/2-ax.width()/2)})}).on("mouseleave","a.clickbadge",function(){c.stop().fadeOut(400)});R("#mailster_receivers").on("click",".create-new-list",function(){var ar=R(this).hide();R(".create-new-list-wrap").slideDown();R(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var av=R(this),au=R(".create-list-type"),at="",ar=R(".mailster-total");if(au.val()==-1){return false}if(at=prompt(mailsterL10n.enter_list_name,x(mailsterL10n.create_list,au.find(":selected").text(),R("#title").val()))){ar.addClass("loading");S("create_list",{name:at,listtype:au.val(),id:X},function(aw){ar.removeClass("loading");var ax=R('<div class="'+((!aw.success)?"error":"updated")+'"><p>'+aw.msg+"</p></div>").hide().prependTo(R(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})},function(aw,ay,ax){ar.removeClass("loading")})}return false}).on("change",".create-list-type",function(){var at=R(this),ar=R(".mailster-total");if(at.val()==-1){return false}at.prop("disabled",true);ar.addClass("loading");S("get_create_list_count",{listtype:at.val(),id:X},function(au){at.prop("disabled",false);ar.removeClass("loading").html(au.count)},function(au,aw,av){at.prop("disabled",false);ar.removeClass("loading").html("")})}).on("click",".mailster-total",function(){R(".create-list-type").trigger("change")});R(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#50626f",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(ar){this.$el.find("span").text(Math.round(ar))},onStop:function(ar){this.$el.find("span").text(Math.round(ar))}});j.on("heartbeat-send",function(at,ar){if(ar.wp_autosave){delete ar.wp_autosave}ar.mailster={page:"edit",id:X}}).on("heartbeat-tick",function(ay,aw){if(!aw.mailster[X]){return}var au=aw.mailster[X],at=R("#stats").find(".verybold"),av=R("#stats").find(".piechart"),ar=R(".progress"),ax=(au.sent/au.total*100);R(".hb-sent").html(au.sent_f);R(".hb-deleted").html(au.deleted_f);R(".hb-opens").html(au.opens_f);R(".hb-clicks").html(au.clicks_f);R(".hb-clicks_total").html(au.clicks_total_f);R(".hb-unsubs").html(au.unsubs_f);R(".hb-bounces").html(au.bounces_f);R(".hb-geo_location").html(au.geo_location);R.each(au.environment,function(az){R(".hb-"+az).html((this.percentage*100).toFixed(2)+"%")});if(R("#stats_opens").length){R("#stats_opens").data("easyPieChart").update(Math.round(au.open_rate))}if(R("#stats_clicks").length){R("#stats_clicks").data("easyPieChart").update(Math.round(au.click_rate))}if(R("#stats_unsubscribes").length){R("#stats_unsubscribes").data("easyPieChart").update(Math.round(au.unsub_rate))}if(R("#stats_bounces").length){R("#stats_bounces").data("easyPieChart").update(Math.round(au.bounce_rate))}ar.find(".bar").width(ax+"%");ar.find("span").eq(1).html(au.sent_formatted);ar.find("span").eq(2).html(au.sent_formatted);ar.find("var").html(Math.round(ax)+"%");e(au.clickbadges);if(au.status!=R("#original_post_status").val()&&!R("#mailster_status_changed_info").length){R('<div id="mailster_status_changed_info" class="error inline"><p>'+x(mailsterL10n.statuschanged,'<a href="post.php?post='+X+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});if(typeof wp!="undefined"&&wp.heartbeat){wp.heartbeat.interval("fast")}}}var ai=function(){var av=C.offset();function aG(){y.on("click","a.template",aE).on("click","a.save-template",aC).on("click","a.clear-modules",ay).on("click","a.preview",aA).on("click","a.undo",aF).on("click","a.redo",aB).on("click","a.code",aw).on("click","a.plaintext",ax).on("click","a.dfw",ar).on("click","a.file",at);H.on("click","button.save-template",aD).on("click","button.save-template-cancel",tb_remove);af.on("scroll.optionbar",function(){var aH=af.scrollTop();if(aH<av.top-50||aH>av.top+C.height()-120){if(/fixed-optionbar/.test(H[0].className)){H.removeClass("fixed-optionbar")}y.width("auto")}else{if(!/fixed-optionbar/.test(H[0].className)){H.addClass("fixed-optionbar")}y.width(C.width())}}).on("resize.optionbar",function(){av=C.offset();af.trigger("scroll.optionbar")})}function aC(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);R("#new_template_name").focus().select();return false}function aD(){a("disable");var aK=R("#new_template_name").val();if(!aK){return false}a("save");var aH=R("#new_template-ajax-loading").css("display","inline"),aJ=R("#new_template_modules").is(":checked"),aN=R("#new_template_active_modules").is(":checked"),aL=R("#new_template_saveas_dropdown").val(),aI=!!parseInt(R('input[name="new_template_overwrite"]:checked').val(),10),aM=i();S("create_new_template",{name:aK,modules:aJ,activemodules:aN,overwrite:aI?aL:false,template:R("#mailster_template_name").val(),content:aM,head:u.val()},function(aO){aH.hide();if(aO.success){if(window.wp){window.wp=null}window.location=aO.url}else{alert(aO.msg)}},function(aO,aQ,aP){aH.hide()});return false}function aF(){if(ao){ao--;U(J[ao],100,false);Y.val(J[ao]);y.find("a.redo").removeClass("disabled");if(!ao){R(this).addClass("disabled")}}return false}function aB(){var aH=J.length;if(ao<aH-1){ao++;U(J[ao],100,false);Y.val(J[ao]);y.find("a.undo").removeClass("disabled");if(ao>=aH-1){R(this).addClass("disabled")}}return false}function ay(){if(confirm(mailsterL10n.remove_all_modules)){var aH=D.contents().find("module");var aI=D.contents().find("modules");aI.slideUp(function(){aH.remove();aI.html("").show();a("refresh");a("save")})}return false}function aA(){a("save");var aL=R(this),aJ=i(),aI=O.val(),aH=ab.val(),aK=W.val();if(y.find("a.preview").is(".loading")){return false}y.find("a.preview").addClass("loading");S("set_preview",{id:X,content:aJ,head:u.val(),issue:R("#mailster_autoresponder_issue").val(),subject:aI,preheader:aH},function(aM){y.find("a.preview").removeClass("loading");R(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aM.hash+"&_wpnonce="+aM.nonce);tb_show((aK?x(mailsterL10n.preview_for,'"'+aK+'"'):mailsterL10n.preview),"#TB_inline?hash="+aM.hash+"&_wpnonce="+aM.nonce+"&width="+(Math.min(1200,af.width()-50))+"&height="+(af.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aM,aO,aN){y.find("a.preview").removeClass("loading")})}function az(){y.remove()}function au(){R("#new_template_name").on("focus",function(){j.unbind("keypress.mailster").bind("keypress.mailster",function(aH){if(aH.keyCode==13){aD();return false}})}).select().focus().on("blur",function(){j.unbind("keypress.mailster")})}function aE(aH){var aI=R(this);aI.parent().find("ul").eq(0).slideToggle(100);return false}function aw(){var aI=!D.is(":visible");var aH;if(!aI){aH=n(B());y.find("a.code").addClass("loading");a("disable");S("toggle_codeview",{bodyattributes:aH.parts[2],content:aH.content,head:aH.head},function(aJ){y.find("a.code").addClass("active").removeClass("loading");N.hide();Y.val(aJ.content);y.find("a").not("a.redo, a.undo, a.code").addClass("disabled");P=CodeMirror.fromTextArea(Y.get(0),E)},function(aJ,aL,aK){y.find("a.code").addClass("active").removeClass("loading");a("enable")})}else{aH=n(P.getValue());P.clearHistory();y.find("a.code").addClass("loading");a("disable");S("toggle_codeview",{bodyattributes:aH.parts[2],content:aH.content,head:aH.head},function(aJ){U(aJ.content,100,true,aJ.style);N.show();Y.hide();R(".CodeMirror").remove();y.find("a.code").removeClass("active").removeClass("loading");y.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");a("enable")},function(aJ,aL,aK){y.find("a.code").addClass("active").removeClass("loading");a("enable")})}return false}function ax(){var aH=!D.is(":visible");if(!aH){y.find("a.plaintext").addClass("active");N.hide();b.show();ae.show();y.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled")}else{N.show();ae.hide();y.find("a.plaintext").removeClass("active");y.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");a("refresh")}return false}function ar(aH){if(aH.type=="mouseout"&&!/DIV|H3/.test(aH.target.nodeName)){return}av=C.offset();if(!H.hasClass("focus-on")){H.removeClass("focus-off").addClass("focus-on");R("#wpbody").on("mouseleave.dfw",ar);y.find("a.dfw").addClass("active");if(af.scrollTop()<av.top){d(av.top-80)}}else{H.removeClass("focus-on").addClass("focus-off");R("#wpbody").off("mouseleave",ar);y.find("a.dfw").removeClass("active")}return false}function at(aH){window.onbeforeunload=null}aG();return{hide:function(){az()}}};var aq=function(){var bi=R("#editbar"),aQ,a9={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a8=bi.find(".imagepreview"),aL=bi.find(".imagewidth"),aH=bi.find(".imageheight"),aw=bi.find(".imagecrop"),bq=bi.find(".factor"),ba=bi.find(".highdpi"),a0=bi.find(".original"),aF=bi.find(".imagelink"),bt=bi.find(".imageurl"),bw=bi.find(".orgimageurl"),ay=bi.find(".imagealt"),bb=bi.find(".singlelink"),bs=bi.find(".buttonlink"),aV=bi.find(".buttonlabel"),aD=bi.find(".buttonalt"),aK=bi.find(".button-nav"),bv=bi.find("ul.buttons"),be,aR,bk,bn,ax,bj,aJ,aA,aU,aE,aC,aB,ar=R("#wp-mailster-editor-wrap"),au="",bg=R("#post-search"),av=R("#image-search"),bc=R('[name="image-search-type"]');function bp(){bi.on("keyup change","input.live",at).on("keyup change","#mailster-editor",at).on("click",".replace-image",a5).on("change",".highdpi",aZ).on("click","button.save",aP).on("click",".cancel",az).on("click","a.remove",aX).on("click","a.reload",bm).on("click","a.single-link-content",aT).on("click","a.add_image",a4).on("click","a.add_image_url",aI).on("click",".imagelist li",aN).on("dblclick",".imagelist li",aP).on("change","#post_type_select input",bm).on("click",".postlist li",bf).on("click",".load-more-posts",bl).on("click","a.btnsrc",bu).on("click",".imagepreview",aO).on("click","a.nav-tab",aG).on("change","select.check-for-posts",a1).on("change paste","#dynamic_rss_url",a1).on("keyup change","#post-search",a7).on("keyup change","#image-search",a7).on("change",'[name="image-search-type"]',a7).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aY).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bo);am(D.contents().find("img").eq(0),function(by,bz,bA){var bx=bA>=1.5;bq.val(bA);ba.prop("checked",bx);(bx)?bi.addClass("high-dpi"):bi.removeClass("high-dpi")});aK.on("click","a",function(){R(this).parent().find("a").removeClass("nav-tab-active");R(this).parent().parent().find("ul.buttons").hide();var bx=R(this).addClass("nav-tab-active").attr("href");R("#tab-"+bx.substr(1)).show();return false});bt.on("paste change",function(by){var bx=R(this);setTimeout(function(){var bA=a6(bx.val()),bz=new Image();if(bA){aS();bz.onload=function(){a8.attr("src",bA);aH.val(Math.round(bz.width/(bz.width/bz.height)));bk={width:bz.width,height:bz.height,asp:bz.width/bz.height};aS(false)};bz.onerror=function(){if(by.type!="paste"){alert(x(mailsterL10n.invalid_image,'"'+bA+'"'))}};bz.src=bA}},1)});aL.on("keyup change",function(){if(!aw.is(":checked")){aH.val(Math.round(aL.val()/bk.asp))}aM()});aH.on("keyup change",function(){if(!aw.is(":checked")){aL.val(Math.round(aH.val()*bk.asp))}aM()});aw.on("change",function(){if(!aw.is(":checked")){aH.val(Math.round(aL.val()/bk.asp));aw.parent().removeClass("not-cropped")}else{aw.parent().addClass("not-cropped")}aM()});R("#dynamic_embed_options_post_type").on("change",function(){var bx=R("#dynamic_embed_options_cats"),by=R(this).val();bx.find("select").prop("disabled",true);bi.find(".dynamic-rss")[by=="rss"?"show":"hide"]();aS();S("get_post_term_dropdown",{posttype:by},function(bz){aS(false);if(bz.success){bx.html(bz.html);if(ax&&ax.terms){var bA=bx.find(".dynamic_embed_options_taxonomy_wrap");R.each(ax.terms,function(bC,bB){if(!bB){return}var bD=bB.split(",");R.each(bD,function(bF,bH){var bE=bA.eq(bC).find("select").eq(bF),bG;if(!bE.length){bG=bA.eq(bC).find("select").last();bE=bG.clone();bE.insertAfter(bG);R("<span> "+mailsterL10n.or+" </span>").insertBefore(bE)}bE.val(bH)})})}}a1()},function(bz,bB,bA){aS(false)})});bi.on("keypress.mailster",function(bx){if(bx.keyCode==13&&bx.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(bx){switch(bx.keyCode){case 27:az();return false;break;case 13:if(aR.type!="multi"&&aR.type!="codeview"){aP();return false}break}});bi.find(".current-tag").on("click","a",function(){return false});if(bi.draggable){bi.draggable({distance:20,axis:"y"})}if(o&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){a3(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){a3(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){a3(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){a3(this)})}}}function br(bx){if(bi.draggable){if(bx!==false){bi.draggable("enable")}else{bi.draggable("disable")}}}function aY(){br(false)}function bo(){br(true)}function aG(bz,bx){var by;if(typeof bz=="string"){by=aQ.find('a[href="'+bz+'"]')}else{by=R(this);bz=by.attr("href")}by.parent().find("a.nav-tab").removeClass("nav-tab-active");by.addClass("nav-tab-active");aQ.find(".tab").hide();aQ.find(bz).show();if(bz=="#dynamic_embed_options"&&bx!==false){R("#dynamic_embed_options_post_type").trigger("change")}if(bz=="#image_button"){be="image"}if(bz=="#text_button"){be="text"}aJ=aQ.find(bz).find(".postlist").eq(0);return false}function a5(){aS();var bA=bq.val(),bx=aR.element.width(),bz=Math.round(bx/1.6),by=R("<img>",{src:"https://dummy.mailster.co/"+(bx*bA)+"x"+(bz*bA)+".jpg",alt:aR.content,label:aR.content,width:bx,height:bz,border:0,editable:aR.content});by[0].onload=function(){by.attr({width:bx,height:bz}).removeAttr("style");bh()};if(aR.element.parent().is("a")){aR.element.unwrap()}if(!aR.element.parent().is("td")){aR.element.unwrap()}aR.element.replaceWith(by);return false}function aZ(){if(R(this).is(":checked")){bq.val(2);bi.addClass("high-dpi")}else{bq.val(1);bi.removeClass("high-dpi")}}function a1(){clearInterval(aU);aS();aU=setTimeout(function(){var bD=bi.find("#dynamic_embed_options_post_type").val(),bA=bi.find("#dynamic_embed_options_content").val(),bC=bi.find("#dynamic_embed_options_relative").val(),bB=bi.find(".dynamic_embed_options_taxonomy_wrap"),bz=R("#dynamic_rss_url").val(),by={},bx=[];R.each(bB,function(bG){var bF=R(this).find("select"),bE=[];R.each(bF,function(){var bH=parseInt(R(this).val(),10);if(bH!=-1&&R.inArray(bH,bE)==-1&&!isNaN(bH)){bE.push(bH)}});bE=bE.join(",");if(bE){bx[bG]=bE}});by={id:X,post_type:bD,relative:bC,extra:bx,modulename:aR.name,expect:aR.elements.expects,rss_url:bz};if(JSON.stringify(by)===JSON.stringify(aE)){aS(false);return}R("#dynamic_embed_options").find("h4.current-match").html("&hellip;");R("#dynamic_embed_options").find("div.current-tag").html("&hellip;");if("rss"==bD&&!bz){aS(false);return}aE=by;S("check_for_posts",by,function(bE){aS(false);if(bE.success){bn=bE.pattern;R("#dynamic_embed_options").find("h4.current-match").html(bE.title);R("#dynamic_embed_options").find("div.current-tag").text(bE.pattern.title+"\n\n"+bE.pattern[bA])}},function(bE,bG,bF){aS(false)})},500)}function a6(bB,bx,by,bC,bA){bx=bx||aL.val();by=by||aH.val()||Math.round(bx/1.6);bC=typeof bC=="undefined"?aw.prop(":checked"):bC;bA=typeof bA=="undefined"?a0.prop(":checked"):bA;if(/^\{([a-z0-9-_,;:|~]+)\}$/.test(bB)){var bz=bq.val();bB=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+bB.replace("{","").replace("}","")+"&w="+Math.abs(bx)+"&h="+Math.abs(by)+"&c="+(bC?1:0)+"&o="+(bA?1:0)+"&f="+bz}return bB}function a2(by){if(-1!==by.indexOf("?action=mailster_image_placeholder&tag=")){var bx=by.match(/&tag=([a-z0-9-_,;:|~]+)&/);return"{"+bx[1]+"}"}return false}function at(bx){if((bx.keyCode||bx.which)!=27&&aR){aR.element.html(R(this).val())}}function aS(bx){if(bx===false){R("#editbar-ajax-loading").hide();bi.find(".buttons").find("button").prop("disabled",false)}else{R("#editbar-ajax-loading").css("display","inline");bi.find(".buttons").find("button").prop("disabled",true)}}function aP(){if(aR.type=="img"){var bP=aR.element.is("img");if(bt.val()){bk={id:null,name:"",src:a6(bt.val()),width:bk.width,height:bk.height,asp:bk.width/bk.height}}if(bk){aS();var bL=bq.val()||1,bC=aL.val(),bJ=aH.val(),bN=aw.is(":checked"),bH=a0.is(":checked"),bE=bP?"src":"background",bK;aR.element.attr({"data-id":bk.id}).data("id",bk.id).addClass("mailster-loading");if(bP){aR.element.attr({src:bk.src,alt:bk.name});if(!aR.is_percentage){aR.element.attr("width",Math.round(bC))}if(aR.element.attr("height")&&aR.element.attr("height")!="auto"){aR.element.attr("height",Math.round(bJ))}if(bN){aR.element.attr({"data-crop":true}).data("crop",true)}if(bH){aR.element.attr({"data-original":true}).data("original",true)}}if(bk.src){aR.element.attr(bE,bk.src);if(bK=aR.element.attr("style")){aR.element.attr("style",bK.replace(/url\("?(.+)"?\)/,"url('"+bk.src+"')"))}}S("create_image",{id:bk.id,original:bH,src:bk.src,width:bC*bL,height:bJ*bL,crop:bN},function(bS){aS(false);if(bS.success){a8.attr("src",bS.image.url);bS.image.width=(bS.image.width||bk.width)/bL;bS.image.height=bS.image.width/(bk.asp);bS.image.asp=bk.asp;bk=bS.image;bk.name=ay.val();if(bP){aR.element.one("load error",function(bW){if("error"==bW.type){alert(x(mailsterL10n.invalid_image,bS.image.url))}aR.element.removeClass("mailster-loading");a("save")});aR.element.attr({alt:bk.name});if(!aR.is_percentage){aR.element.attr("width",Math.round(aL.val()))}if(aR.element.attr("height")&&aR.element.attr("height")!="auto"){aR.element.attr("height",Math.round(aH.val()))}if(bN){aR.element.attr({"data-crop":true}).data("crop",true)}if(bH){aR.element.attr({"data-original":true}).data("original",true)}}else{aR.element.removeClass("mailster-loading");var bT=aR.element.html(),bV=bT.match(/<modules/),bU;if(bw.val()){if(bV){if(bV=bT.match(new RegExp("<v:background(.*)</v:background>","s"))){aR.element.html(an(bT,bV[0],an(bV[0],bw.val(),bk.url)))}}else{aR.element.html(an(bT,bw.val(),bk.url));aR.element.find("single, multi").removeAttr("id")}}}aR.element.removeAttr(bE).attr(bE,bk.url)}else{aR.element.removeClass("mailster-loading")}ay.val("");bh()},function(bS,bU,bT){aS(false)})}else{aR.element.attr({alt:ay.val()});bh()}if(aR.element.parent().is("a")){aR.element.unwrap()}var by=aF.val();if(by){aR.element.wrap('<a href="'+by+'"></a>')}return false}else{if(aR.type=="btn"){var by=bs.val();if(!by&&!confirm(mailsterL10n.remove_btn)){return false}var bx=aQ.find("a.active").find("img").attr("src");if(typeof bx=="undefined"){be="text";if(!aV.val()){aV.val(mailsterL10n.read_more)}}aR.element.removeAttr("tmpbutton");if("image"==be){var bL=bq.val();var bR=new Image();bR.onload=function(){if(!aR.element.find("img").length){var bT=aR.element.closest(".textbutton");var bS=R('<a href="" editable label="'+aR.name+'"><img></a>');(bT.length)?bT.replaceWith(bS):aR.element.replaceWith(bS);aR.element=bS}aR.element.find("img").attr({src:bx,width:Math.round((bR.width||aR.element.width())/bL),height:Math.round((bR.height||aR.element.height())/bL),alt:aD.val()});(by)?aR.element.attr("href",by):aR.element.remove();bh()};bR.src=bx}else{var bA=aR.element.closest(".textbutton"),bz=aV.val();if(!bA.length){aR.element.replaceWith('<table class="textbutton" align="left" role="presentation"><tr><td align="center" width="auto"><a href="'+by+'" editable label="'+bz+'">'+bz+"</a></td></tr></table>")}else{if(aR.element[0]==bA[0]){aR.element=bA.find("a")}aR.element.text(bz)}if(by){aR.element.attr("href",by)}else{aR.element.remove();bA.remove()}bh()}return false}else{if(aR.type=="auto"){var bM=R("#embedoption-bar").find(".nav-tab-active").data("type"),bQ=aR.element.data("position")||0,bF,bD=[],bO,bG;aR.element.removeAttr("data-tag data-rss").removeData("tag").removeData("data-rss");if("dynamic"==bM){bF=bi.find("#dynamic_embed_options_content").val();bO=bi.find("#dynamic_embed_options_post_type").val();bG=R("#dynamic_rss_url").val();bn.content=bn[bF];aR.element.attr("data-tag",bn.tag).data("tag",bn.tag);if("rss"==bO){aR.element.attr("data-rss",bG).data("rss",bG)}}else{bF=R(".embed_options_content:checked").val();aR.element.removeAttr("data-tag").removeData("tag")}if(bn){if(aR.elements.single.length){aR.elements.single.each(function(bS,bV){var bY=R(this),bU=bY.attr("expect")||"title",bX=bn[bU]?bn[bU]:"",bT=[],bW=[];if(!R.isArray(bX)){bT[bQ]=bX}else{bT=bX}if(bT[bS]){R(this).html(bT[bS])}})}if(aR.elements.multi.length){aR.elements.multi.each(function(bS,bV){var bY=R(this),bU=bY.attr("expect")||bF,bX=bn[bU]?bn[bU]:"",bT=[],bW=[];if(!R.isArray(bX)){bT[bQ]=bX}else{bT=bX}if(bT[bS]){R(this).html(bT[bS])}})}if(bn.link){if(aR.elements.buttons.length){aR.elements.buttons.eq(bQ).attr("href",bn.link)}}else{if(aR.elements.buttons.parent().length&&aR.elements.buttons.parent()[0].nodeName=="TD"){aR.elements.buttons.eq(bQ).closest(".textbutton").remove()}else{if(aR.elements.buttons.length){if(aR.elements.buttons.eq(bQ).last().find("img").length){aR.elements.buttons.remove()}}}}if(bn.image&&aR.elements.images.length){if(!R.isArray(bn.image)){bD[bQ]=bn.image}else{bD=bn.image}bn.image=bD;aS();aR.elements.images.each(function(bV,bY){if(!bn.image[bV]){return}var bT=R(this);var bX=bq.val();if("static"==bM){S("create_image",{id:bn.image[bV].id,original:a0.is(":checked"),width:bT.width()*bX,height:bT.height()*bX,crop:bT.data("crop")},function(b1){if(b1.success){aS(false);if(a0.is(":checked")){bT.attr({"data-original":true}).data("original",true)}if("img"==bT.prop("tagName").toLowerCase()){bT.attr({"data-id":bn.image[bV].id,src:b1.image.url,width:Math.round(b1.image.width/bX),alt:bn.alt||bn.title[bV]}).data("id",bn.image[bV].id);if(bT.attr("height")&&bT.attr("height")!="auto"){bT.attr("height",Math.round(b1.image.height/bX))}if(bT.parent().is("a")){bT.unwrap()}if(bn.link){bT.wrap("<a>");bT.parent().attr("href",bn.link)}}else{var b2=bT.attr("background");bT.attr({"data-id":bn.image[bV].id,background:b1.image.url}).data("id",bn.image[bV].id).css("background-image","");aR.element.html(an(aR.element.html(),b2,b1.image.url));aR.element.find("single, multi").removeAttr("id");a("save");a("refresh")}}},function(b1,b3,b2){aS(false)});return false}else{if("dynamic"==bM){var bS=bT.width(),bW=bT.data("crop"),b0=a0.is(":checked"),bZ=bW?bT.height():null;if("img"==bT.prop("tagName").toLowerCase()){bT.removeAttr("data-id").attr({src:a6(bn.image[bV],bS,bZ,bW,b0),width:bS,alt:bn.alt||bn.title[bV]}).removeData("id");if(bT.attr("height")){bT.attr("height",bZ||Math.round(bS/1.6))}}else{var bU=bT.attr("background");bT.removeAttr("data-id").attr({background:a6(bn.image[bV],bS)}).removeData("id").css("background-image","");aR.element.html(an(aR.element.html(),bU,a6(bn.image[bV],bS,bZ,bW,b0)));aR.element.find("single, multi").removeAttr("id")}}}})}bQ=bQ+1>=(aR.elements.multi.length||aR.elements.single.length||aR.elements.images.length)?0:bQ+1;aR.element.data("position",bQ);D.contents().find("html").find("img").each(function(){this.onload=function(){a("refresh")}})}}else{if(aR.type=="multi"){if(o&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){var bI=tinymce.get("mailster-editor").getContent();bI=bI.replace('href="http://{','href="{');aR.element.html(bI)}}else{if(aR.type=="single"){if(aR.conditions){aR.aa="<if";R.each(R(".conditinal-area"),function(){aR.aa=""})}if(aR.element.parent().is("a")){aR.element.unwrap()}var by=bb.val();if(by){aR.element.wrap('<a href="'+by+'"></a>')}}else{if(aR.type=="codeview"){var bB=P.getValue();aR.element.html(bB);aR.modulebuttons.prependTo(aR.element)}}}}}}bh();return false}function aX(){if(aR.element.parent().is("a")){aR.element.unwrap()}if("btn"==aR.type){var by=aR.element.closest(".textbutton"),bx=by.parent();if(!by.length){by=aR.element}if(bx.is("buttons")&&!bx.find(".textbutton").length){bx.remove()}else{by.remove()}}else{if("img"==aR.type&&"img"!=aR.tag){aR.element.attr("background","")}else{aR.element.remove()}}bh();return false}function az(){switch(aR.type){case"img":case"btn":if(aR.element.is("[tmpbutton]")){aR.element.remove()}break;default:aR.element.html(aR.content);aR.element.find("single, multi").removeAttr("id")}bh();return false}function bu(){var bz=R(this),bx=bz.data("link");aQ.find(".btnsrc").removeClass("active");bz.addClass("active");aD.val(bz.attr("title"));if(bx){var by;bs.val(bx);if((by=(bx+"").indexOf("USERNAME",0))!=-1){bs.focus();p(bs[0],by,by+8)}}return false}function aO(){R(this).toggleClass("zoom")}function aN(bz,by){var bC=by||R(this),bB=bC.data("id"),bx=bC.data("name"),bA=bC.data("src");if(!bB){return}bk={id:bB,name:bx,src:bA};aS();aQ.find("li.selected").removeClass("selected");bC.addClass("selected");if(aR.element.data("id")==bB){ay.val(aR.element.attr("alt"))}else{if(aR.element.attr("alt")!=bx){ay.val(bx)}}bt.val("");a8.attr("src","").on("load",function(){a8.off("load");aR.width=a8.width();aR.height=a8.height();aR.asp=bC.data("asp")||(aR.width/aR.height);bk.asp=aR.asp;aS(false);if(!aw.is(":checked")){aH.val(Math.round(aL.val()/aR.asp))}aM()}).attr("src",bA);return bk}function aM(){var bx=Math.round(0.5*(aR.height-(aR.width*(aH.val()/aL.val()))))||0,by=parseInt(bq.val(),10);a8.css({clip:"rect("+(bx)+"px,"+(aR.width*by)+"px,"+(aR.height*by-bx)+"px,0px)","margin-top":(-1*bx)+"px"})}function bf(){var bB=R(this),bA=bB.data("id"),bx=bB.data("name"),by=bB.data("link"),bz=bB.data("thumbid");if(aR.type=="btn"){bs.val(by);aD.val(bx);aQ.find("li.selected").removeClass("selected");bB.addClass("selected")}else{if(aR.type=="single"){bb.val(by);aQ.find("li.selected").removeClass("selected");bB.addClass("selected")}else{aS();S("get_post",{id:bA,expect:aR.elements.expects},function(bC){aS(false);aQ.find("li.selected").removeClass("selected");bB.addClass("selected");if(bC.success){bn=bC.pattern;aQ.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bn.title+"</span>")}},function(bC,bE,bD){aS(false);aQ.find("li.selected").removeClass("selected")})}}return false}function aW(bT){aR=bT;var bz=bT.element,by=bz.closest("module"),bK=(bB!="img")?bT.offset.top:0,bU=bT.name||"",bB=bT.type,bM=R.trim(bz.html()),bN=bz.find("if"),bF,bS=aR.element.data("position")||0,bR,bI,bD,bG=1;aQ=bi.find("div.type."+bB);bi.addClass("current-"+bB);aR.width=bz.width();aR.height=bz.height();aR.asp=aR.width/aR.height;aR.crop=bz.data("crop")?bz.data("crop"):false;aR.tag=bz.prop("tagName").toLowerCase();aR.is_percentage=bz.attr("width")&&bz.attr("width").indexOf("%")!==-1;aR.content=bM;ax=aR.element.data("tag");au="";a("selectModule",by);if(bN.length){bF={"if":null,elseif:[],"else":null,total:0};bF=[];bi.addClass("has-conditions");bR=aQ.find(".conditinal-area");bI=bi.find(".conditions").eq(0);bI.clone().prependTo(bR);R.each(bN.find("elseif"),function(){var bW=R(this),bV=bW.html();bF.push({el:bW,html:bV,field:bW.attr("field"),operator:bW.attr("operator"),value:bW.attr("value")});bW.detach();bR.clone().val(bV).insertAfter(bR)});R.each(bN.find("else"),function(){var bW=R(this),bV=bW.html();bF.push({el:bW,html:bV});bW.detach();bR.clone().val(bV).insertAfter(bR)});bF.unshift({el:bN,html:bN.html(),field:bN.attr("field"),operator:bN.attr("operator"),value:bN.attr("value")})}else{bi.removeClass("has-conditions")}aR.conditions=bF;if(bB=="img"){a0.prop("checked",aR.original);aw.prop("checked",aR.crop).parent()[aR.crop?"addClass":"removeClass"]("not-cropped");au=R.trim(av.val());bq.val(1);am(bz,function(bV,bW,bX){var bW=bX>=1.5;bq.val(bX);ba.prop("checked",bW);(bW)?bi.addClass("high-dpi"):bi.removeClass("high-dpi");bG=bX})}else{if(bB=="btn"){if(bz.find("img").length){R("#button-type-bar").find("a").eq(1).trigger("click");var bC=bz.find("img").attr("src");if(aK.length){var bx=bi.find("img[src='"+bC+"']");if(bx.length){bi.find("ul.buttons").hide();var bQ=bx.parent().parent().parent();bi.find('a[href="#'+bQ.attr("id").substr(4)+'"]').trigger("click")}else{R.each(bi.find(".button-nav"),function(){R(this).find(".nav-tab").eq(0).trigger("click")})}}aV.val(bz.find("img").attr("alt"));am(bz.find("img"),function(bV,bW,bX){var bW=bX>=1.5;bq.val(bX);ba.prop("checked",bW);(bW)?bi.addClass("high-dpi"):bi.removeClass("high-dpi");bG=bX})}else{R("#button-type-bar").find("a").eq(0).trigger("click");aV.val(R.trim(bz.text())).focus().select();bs.val(aR.element.attr("href"));bi.find("ul.buttons").hide()}}else{if(bB=="auto"){aG("#"+(ax?"dynamic":"static")+"_embed_options",true);au=R.trim(bg.val());if(ax){var bL=ax.substr(1,ax.length-2).split(":"),bA=bL[1].split(";"),bP=bA.shift(),bE=bA.length?bA:null;ax={post_type:bL[0],relative:bP,terms:bE};R("#dynamic_embed_options_post_type").val(ax.post_type).trigger("change");R("#dynamic_embed_options_relative").val(ax.relative).trigger("change")}else{}}else{if(bB=="codeview"){var bJ=aQ.find("textarea"),bO=bz.clone();aR.modulebuttons=bO.find("modulebuttons");bO.find("modulebuttons").remove();bO.find("single, multi").removeAttr("contenteditable spellcheck id dir style class");var bH=R.trim(bO.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));bJ.show().html(bH)}}}}bD=C.offset().top+(aR.offset.top-(af.height()/2)+(aR.height/2));bD=Math.max(C.offset().top-200,bD);d(bD,function(){bi.find("h4.editbar-title").html(bU);bi.find("div.type").hide();bi.find("div."+bB).show();if(by.data("rss")){R("#dynamic_rss_url").val(by.data("rss"))}var bZ=j.scrollTop()+(af.height()/2)-C.offset().top-(bi.height()/2);bi.css({top:bZ});aS();if(bB=="single"){if(bF){R.each(bF,function(b4,b5){var b3=aQ.find(".conditinal-area").eq(b4);b3.find("select.condition-fields").val(b5.field);b3.find("select.condition-operators").val(b5.operator);b3.find("input.condition-value").val(b5.value);b3.find("input.input").val(b5.html)})}else{var b2=bM.replace(/&amp;/g,"&");bb.val("");if(aR.element.parent().is("a")){var bW=aR.element.parent().attr("href");bb.val(bW!="#"?bW:"");aT()}else{if(aR.element.find("a").length){var bY=aR.element.find("a");if(b2==bY.text()){var bW=bY.attr("href");b2=bY.text();bb.val(bW!="#"?bW:"")}}}aQ.find("input").eq(0).val(R.trim(b2))}}else{if(bB=="img"){var bV=parseInt(bz[0].style.maxWidth,10)||bz.parent().width()||bz.width()||null;var b1=parseInt(bz[0].style.maxHeight,10)||bz.parent().height()||bz.height()||null;var b0=bz.attr("src")||bz.attr("background");var bX=a2(b0)||"";if(bz.parent().is("a")){aF.val(bz.parent().attr("href").replace("%7B","{").replace("%7D","}"))}else{aF.val("")}ay.val(bz.attr("alt"));bt.val(bX);bw.val(b0);bz.data("id",bz.attr("data-id"));R(".imageurl-popup").toggle(!!bX);a8.removeAttr("src").attr("src",b0);bj="attachment";aJ=aQ.find(".imagelist");bk={id:bz.data("id"),src:b0,width:bz.width()*bG,height:bz.height()*bG};bk.asp=bk.width/bk.height;bm();aM()}else{if(bB=="btn"){aD.val(bz.find("img").attr("alt"));if(bz.attr("href")){bs.val(bz.attr("href").replace("%7B","{").replace("%7D","}"))}bj="link";aJ=aQ.find(".postlist").eq(0);bm();R.each(aQ.find(".buttons img"),function(){var b3=R(this);b3.css("background-color",bz.css("background-color"));(b3.attr("src")==bC)?b3.parent().addClass("active"):b3.parent().removeClass("active")})}else{if(bB=="auto"){bj="post";aJ=aQ.find(".postlist").eq(0);bm();aR.elements={single:aR.element.find("single"),multi:aR.element.find("multi"),buttons:aR.element.find("a[editable]"),images:aR.element.find("img[editable], td[background], th[background]"),expects:aR.element.find("[expect]").map(function(){return R(this).attr("expect")}).toArray()};if((aR.elements.multi.length||aR.elements.single.length||aR.elements.images.length)>1){bi.find(".editbarpostion").html(x(mailsterL10n.for_area,"#"+(bS+1))).show()}else{bi.find(".editbarpostion").hide()}}else{if(bB=="codeview"){if(P){P.clearHistory();P.setValue("");aQ.find(".CodeMirror").remove()}}}}}}bi.show(0,function(){if(bB=="single"){bi.find("input").focus().select()}else{if(bB=="img"){aL.val(aR.width);aH.val(aR.height);aw.prop("checked",aR.crop)}else{if(bB=="btn"){aL.val(bV);aH.val(b1)}else{if(bB=="multi"){R("#mailster-editor").val(bM);if(o&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bM);tinymce.execCommand("mceFocus",false,"mailster-editor")}}else{if(bB=="codeview"){P=CodeMirror.fromTextArea(bJ.get(0),E)}}}}}});aS(false)},100)}function bm(bx,bA){var bz=R("#post_type_select").find("input:checked").serialize(),by={type:bj,posttypes:bz,search:au,imagetype:bc.filter(":checked").val(),offset:0};if(bj=="attachment"){by.id=bk.id}aJ.empty();aS();S("get_post_list",by,function(bB){aS(false);if(bB.success){aA=bB.itemcount;bd(bB.html,true);bA&&bA()}},function(bB,bD,bC){aS(false)})}function bl(){var bz=R(this),bA=bz.data("offset"),bx=bz.data("type");aS();var by=R("#post_type_select").find("input:checked").serialize();S("get_post_list",{type:bx,posttypes:by,search:au,imagetype:bc.filter(":checked").val(),offset:bA,itemcount:aA},function(bB){aS(false);if(bB.success){aA=bB.itemcount;bz.remove();bd(bB.html,false)}},function(bB,bD,bC){aS(false)});return false}function a7(){var by=R(this),bx=R.trim("attachment"==bj?av.val():bg.val());if((!by.is(":checked")&&au==bx)){return false}au=bx;clearTimeout(aC);aC=setTimeout(function(){bm()},500)}function aT(){R("#single-link").slideDown(200);bb.focus().select();bj="link";aJ=aQ.find(".postlist").eq(0);bm();return false}function bd(by,bx,bz){if(!bz){bz=aJ}if(bx){bz.empty()}if(!bz.html()){bz.html("<ul></ul>")}bz.find("ul").append(by)}function aI(){R(".imageurl-popup").toggle();if(!bt.val()&&bk.src.indexOf(location.origin)==-1&&bk.src.indexOf("dummy.mailster.co")==-1){bt.val(bk.src)}bt.focus().select();return false}function a4(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var by=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),bx=R("img").data({id:by.id,name:by.name,src:by.url});bm(null,function(){aN(null,bx)})})}wp.media.frames.mailster_editbar.open()}function a3(bx){clearTimeout(aj);aj=setTimeout(function(){if(!bx){return}var by=R.trim(bx.save());aR.element.html(by)},100)}function bh(){bi.removeClass("current-"+aR.type).hide();aS(false);R("#single-link").hide();a("refresh");a("save");return false}bp();return{open:function(bx){aW(bx)},close:function(){bh()}}};var ap=function(){var ay=R("#mailster_template"),aK=R("#module-selector"),aA=R("#module-search"),aM=aK.find("li"),aJ=R("a.toggle-modules"),aF=D.contents().find("modules"),aD=D.contents().find("body"),aN=aF.find("module"),aG,av={},aI=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function ax(){var aQ=aK.data("current");at(R(this).data("id"),((aQ&&aQ.is("module"))?aQ:false),true,true);return false}function aB(){var aQ=R(this).parent().parent().parent().addClass("ui-sortable-fly-over"),aR=aQ.prev("module").addClass("ui-sortable-fly-under"),aS=(ag.scrollTop()||document.scrollingElement.scrollTop)-aR.height();aQ.css({transform:"translateY(-"+aR.height()+"px)"});aR.css({transform:"translateY("+aQ.height()+"px)"});d(aS,function(){aQ.insertBefore(aR.css({transform:""}).removeClass("ui-sortable-fly-under")).css({transform:""}).removeClass("ui-sortable-fly-over");a("refresh");a("save")},250);return false}function aC(){var aQ=R(this).parent().parent().parent().addClass("ui-sortable-fly-over"),aR=aQ.next("module").addClass("ui-sortable-fly-under"),aS=(ag.scrollTop()||document.scrollingElement.scrollTop)+aR.height();aQ.css({transform:"translateY("+aR.height()+"px)"});aR.css({transform:"translateY(-"+aQ.height()+"px)"});d(aS,function(){aQ.insertAfter(aR.css({transform:""}).removeClass("ui-sortable-fly-under")).css({transform:""}).removeClass("ui-sortable-fly-over");a("refresh");a("save")},250);return false}function au(){var aQ=R(this).parent().parent().parent(),aR=aQ.clone().removeAttr("selected").hide();at(aR,aQ,false,true);return false}function az(){var aQ=R(this).parent().parent().parent();M.open({element:aQ,name:aQ.attr("label"),type:"auto",offset:aQ.offset()});return false}function aE(){var aS=R(this),aR=aS.val(),aQ=aS.parent().parent();if(!aR){aR=aS.attr("placeholder");aS.val(aR)}aQ.attr("label",aR)}function aP(){var aQ=R(this).parent().parent().parent();aQ.fadeTo(100,0,function(){aQ.slideUp(100,function(){aQ.remove();aN=D.contents().find("module");if(!aN.length){aF.html("")}a("refresh");a("save")})});return false}function at(aR,aS,aT,aQ){var aV;if(av[aR]){aV=av[aR].el.clone()}else{if(aR instanceof jQuery){aV=R(aR);aV.find("single, multi, buttons").removeAttr("contenteditable spellcheck id dir style class")}else{return false}}if(!aS&&!aF.length){return false}aN=aF.find("module");if(aS){(aT?aV.hide().insertBefore(aS):aV.hide().insertAfter(aS))}else{if("footer"==aN.last().attr("type")){aV.hide().insertBefore(aN.last())}else{aV.hide().appendTo(aF)}}aN=aF.find("module");aV.slideDown(100,function(){aV.css("display","block");a("refresh");a("save")});if(aQ){var aU=aV.offset().top+C.offset().top-(af.height()/2);d(aU)}}function ar(){var aQ=R(this).parent().parent().parent();M.open({element:aQ,name:aQ.attr("label"),type:"codeview",offset:aQ.offset()});return false}function aO(){Z.toggleClass("show-modules");aI=!aI;window.setUserSetting("mailstershowmodules",aI?1:0);setTimeout(function(){a("resize")},200)}function aH(){aM.hide();aK.find("li:contains('"+R(this).val()+"')").show()}function aL(){C.on("click","a.toggle-modules",aO).on("keydown","a.addmodule",function(aQ){if(13==aQ.which){ax.call(this)}}).on("click","a.addmodule",ax);aA.on("keyup",aH).on("focus",function(){aA.select()});R("#module-search-remove").on("click",function(){aA.val("").trigger("keyup").focus();return false});aw()}function aw(){aN=D.contents().find("module");if(!aN.length){aF.html("")}aG=R(ac.val()).add(aN);if(!aG.length){aK.remove();return}aF=D.contents().find("modules");aF.on("click","button.up",aB).on("click","button.down",aC).on("click","button.auto",az).on("click","button.duplicate",au).on("click","button.remove",aP).on("click","button.codeview",ar).on("change","input.modulelabel",aE);var aT="",aX="",aR=0,aW=0;av=[];R.each(aG,function(a0){var a2=R(this);if(a2.is("module")){var aZ=a2.attr("label")||x(mailsterL10n.module,"#"+(++aW)),a1=mailsterdata.codeview?'<button class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></button>':"",a3=(a2.is("[auto]")?'<button class="mailster-btn auto" title="'+mailsterL10n.auto+'"></button>':"");R("<modulebuttons><span>"+a3+'<button class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></button><button class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></button><button class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></button>'+a1+'<button class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></button></span><input class="modulelabel" type="text" value="'+aZ+'" placeholder="'+aZ+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></modulebuttons>').prependTo(a2);if(!a2.parent().length){av.push({name:aZ,el:a2})}}});var aS,aY,aV=R("<dropzone></dropzone>"),aQ=aV.clone(),aU=aV.add(aQ);if(!R._data(aK[0],"events")){aK.on("dragstart.mailster","li",function(aZ){window.mailster_is_modulde_dragging=true;aZ.originalEvent.dataTransfer.setData("Text",this.id);aD.addClass("drag-active");aY=R(aZ.target).data("id");aF.on("dragenter.mailster",function(a0){var a1=R(a0.target).closest("module");if(!a1.length||aS&&aS[0]===a1[0]){return}aS=a1;aQ.appendTo(aS);aV.prependTo(aS);setTimeout(function(){aQ.addClass("visible");aV.addClass("visible");aN.removeClass("drag-up drag-down");a1.prevAll("module").addClass("drag-up");a1.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(a0){a0.preventDefault()}).on("drop.mailster",function(a0){at(aY,aN.length?(aS&&aS[0]===aF?false:aS):false,aV[0]===a0.target,false,true);aN=D.contents().find("module");a0.preventDefault()});aU.on("dragenter.mailster",function(a0){R(this).addClass("drag-over")}).on("dragleave.mailster",function(a0){R(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aZ){aS=null;aD.removeClass("drag-active");aU.removeClass("visible drag-over").remove();aN.removeClass("drag-up drag-down");aF.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aU.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}}aL();return{refresh:function(){aw()}}};function d(au,at,ar){au=Math.round(au);if(isNaN(ar)){ar=200}if(!k&&(ag.scrollTop()==au||document.scrollingElement.scrollTop==au)){at&&at();return}ag.stop().animate({scrollTop:au},ar,function(){at&&at()})}function q(at,ar){at=Math.round(at);if(ar){window.scrollBy(0,at)}else{window.scrollTo(0,at)}}R(window).on("Mailster:refresh",function(){clearTimeout(F);F=setTimeout(function(){a("resize");if(!f){w()}else{e()}},10)}).on("Mailster:resize",function(){if(!I){return false}setTimeout(function(){if(!D[0].contentWindow.document.body){return}var ar=D.contents().find("body").outerHeight()||D.contents().height()||D[0].contentWindow.document.body.offsetHeight||D.contents().find("html")[0].innerHeight||D.contents().find("html").height();ar=Math.max(500,ar+4);R("#editor-height").val(ar);D.attr("height",ar)},50)}).on("Mailster:save",function(){if(!f&&I){var au=B();var at=J.length,ar=J[at-1];if(ar!=au){Y.val(au);ab.prop("readonly",!au.match("{preheader}"));J=J.splice(0,ao+1);J.push(au);if(at>=mailsterL10n.undosteps){J.shift()}ao=J.length-1;if(ao){y.find("a.undo").removeClass("disabled")}y.find("a.redo").addClass("disabled");if(wp&&wp.autosave){wp.autosave.local.save()}}}}).on("Mailster:disable",function(){al=true;R(".button").prop("disabled",true);R("input:visible").prop("disabled",true)}).on("Mailster:enable",function(){R(".button").prop("disabled",false);R("input:visible, input.wp-color-picker").prop("disabled",false);al=false}).on("Mailster:selectModule",function(at){if(!at.detail){return}var ar=at.detail[0]}).on("Mailster:updateCount",function(){clearTimeout(t);t=setTimeout(function(){var aB=[],aA=[],aw=R("#list-checkboxes").find("input, select"),ax=R("#list-checkboxes").find("input.list"),at=R("#list_extra"),av={},az=R(".mailster-total"),ay=R("#mailster_conditions_render"),ar=R(".mailster-conditions-wrap > .mailster-condition-group"),au=0;R.each(ax,function(){var aC=R(this).val();if(R(this).is(":checked")){aB.push(aC)}});av.id=X;av.lists=aB;av.ignore_lists=R("#ignore_lists").is(":checked");R.each(ar,function(){var aC=R(this).find(".mailster-condition");R.each(aC,function(){var aG=R(this),aE,aF=aG.find(".condition-field").val(),aD=aG.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!aD||!aF){return}aE=aG.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return R(this).val()}).toArray();if(aE.length==1){aE=aE[0]}if(!aA[au]){aA[au]=[]}aA[au].push({field:aF,operator:aD,value:aE})});au++});av.operator=R("select.mailster-list-operator").val();av.conditions=aA;az.addClass("loading");a("disable");S("get_totals",av,function(aC){a("enable");az.removeClass("loading").html(aC.totalformatted);ay.html(aC.conditions)},function(aC,aE,aD){a("enable");az.removeClass("loading").html("?")})},10)}).on("Mailster:xxx",function(){});function a(){var ar=arguments[0];var at=arguments[1]||null;var au;if(k){au=document.createEvent("CustomEvent");au.initCustomEvent("Mailster:"+ar,false,false,{detail:at})}else{au=new CustomEvent("Mailster:"+ar,{detail:at})}window.dispatchEvent(au);D[0].contentWindow.window.dispatchEvent(au)}function w(){C.find(".content.mailster-btn").remove();var ar=D.contents().find("html"),at=null;if(!ar){return}setTimeout(function(){if(!R._data(ar[0],"events")){ar.off(".mailster").on("click.mailster","img[editable]",function(aw){aw.stopPropagation();var az=R(this),aA=az.offset(),ay=aA.top+61,ax=aA.left,au=az.attr("label"),av="img";M.open({offset:aA,type:av,name:au,element:az})}).on("click.mailster","module td[background],module th[background]",function(au){au.stopPropagation();at=true}).on("click.mailster","td[background], th[background]",function(aw){aw.stopPropagation();if(!at&&aw.target!=this){return}at=null;var az=R(this),aA=az.offset(),ay=aA.top+61,ax=aA.left,au=az.attr("label"),av="img";M.open({offset:aA,type:av,name:au,element:az})}).on("click.mailster","a[editable]",function(aw){aw.stopPropagation();aw.preventDefault();var az=R(this),aA=az.offset(),ay=aA.top+40,ax=aA.left,au=az.attr("label"),av="btn";M.open({offset:aA,type:av,name:au,element:az})})}if(!mailsterdata.inline){ar.on("click.mailster","multi, single",function(aw){aw.stopPropagation();var az=R(this),aA=az.offset(),ay=aA.top+40,ax=aA.left,au=az.attr("label"),av=az.prop("tagName").toLowerCase();M.open({offset:aA,type:av,name:au,element:az})})}},500)}function e(ar){C.find(".clickbadge").remove();var ar=ar||R("#mailster_click_stats").data("stats"),at=parseInt(ar.total,10);if(!at){return}R.each(ar.clicks,function(av,au){R.each(au,function(ay,aC){var aB=D.contents().find('a[href="'+av.replace("&amp;","&")+'"]').eq(ay);if(aB.length){aB.css({display:"inline-block"});var ax=aB.offset(),aA=ax.top,aw=ax.left+5,aE=(aC.clicks/at)*100,aD=(aE<1?"&lsaquo;1":Math.round(aE))+"%",az=R('<a class="clickbadge '+(aE<40?"clickbadge-outside":"")+'" data-p="'+aE+'" data-link="'+av+'" data-clicks="'+aC.clicks+'" data-total="'+aC.total+'"><span style="width:'+(Math.max(0,aE-2))+'%">'+(aE<40?"&nbsp;":aD)+"</span>"+(aE<40?" "+aD:"")+"</a>").css({top:aA,left:aw}).appendTo(C)}})})}function Q(ax,au,av){if(!ax){ax=au}if(!au){return false}ax=ax.toLowerCase();au=au.toLowerCase();if(ax==au){return false}var at=i(),aw=new RegExp(ax,"gi"),ar=ac.val();if(av){av.data("value",au)}R("#mailster-color-"+ax.substr(1)).attr("id","mailster-color-"+au.substr(1));if(aw.test(ar)){ac.val(ar.replace(aw,au))}if(aw.test(at)){U(at.replace(aw,au),30)}}function an(au,ar,at){if(ar===at){return au}do{au=au.replace(ar,at)}while(ar&&au.indexOf(ar)!==-1);return au}function L(at){var au=i(),av=/\/img\/version(\d+)\//g,aw="/img/"+at+"/";html=au.replace(av,aw);var ar=ac.val();ac.val(ar.replace(av,aw));U(html);return}function B(){var ar=D[0].contentWindow.document.body,ax,av,aw,at,au="";if(typeof ar=="null"||!ar){return""}ax=R("<div>"+ar.innerHTML+"</div>");ax.find(".mce-tinymce, .mce-widget, .mce-toolbar-grp, .mce-container, .screen-reader-text, .ui-helper-hidden-accessible, .wplink-autocomplete, modulebuttons, mailster, #mailster-editorimage-upload-button, button").remove();ax.find("#droplr-chrome-extension-is-installed").remove();ax.find("single, multi, module, modules, buttons").removeAttr("contenteditable spellcheck id dir style class selected");av=R.trim(ax.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));aw=ar.attributes||[];at=aw.length;if(at){while(at--){au=" "+aw[at].name+'="'+R.trim(aw[at].value)+'"'+au}}au=R.trim(au.replace(/(webkit |wp\-editor|mceContentBody|position: relative;|cursor: auto;|modal-open| spellcheck="(true|false)")/g,"").replace(/(class="(\s*)"|style="(\s*)")/g,""));return u.val()+"\n<body"+(au?" "+au:"")+">\n"+av+"\n</body>\n</html>"}function i(){return Y.val()||B()}function n(ar){var at=ar.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m);return{parts:at?at:["","","","<multi>"+ar+"</multi>"],content:at?at[3]:"<multi>"+ar+"</multi>",head:at?R.trim(at[1]):"",bodyattributes:at?R("<div"+(at[2]||"")+"></div>")[0].attributes:""}}function U(ax,av,aw,ar){var at=n(ax);var az=at.bodyattributes.length,aA=(g||l)?D[0].contentWindow.document:s,au=R(aA).find("head").find("link"),ay=aA.getElementsByTagName("head")[0];u.val(at.head);if(!ar){ar=""}ay.innerHTML=at.head.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3"+ar);R(ay).append(au);aA.body.innerHTML=at.content;if(az){while(az--){aA.body.setAttribute(at.bodyattributes[az].name,at.bodyattributes[az].value)}}if(av!==false){clearTimeout(aj);aj=setTimeout(function(){K&&K.refresh&&K.refresh();a("refresh")},av||100)}else{a("refresh")}if(typeof aw=="undefined"||aw===true){a("save")}}function T(){return W.val()+Y.val()+b.val()+O.val()+ab.val()}function S(av,au,aw,at,ar){if(R.isFunction(au)){if(R.isFunction(aw)){at=aw}aw=au;au={}}ar=ar?ar:"JSON";R.ajax({type:"POST",url:ajaxurl,data:R.extend({action:"mailster_"+av,_wpnonce:G},au),success:function(ay,az,ax){aw&&aw.call(this,ay,az,ax)},error:function(az,aC,aB){var ax=R.trim(az.responseText);if(aC=="error"&&!aB){return}if(console){console.error(ax)}if("JSON"==ar){var ay=ax.match(/{(.*)}$/);if(ay&&aw){try{aw.call(this,R.parseJSON(ay[0]))}catch(aA){if(console){console.error(aA)}}return}}at&&at.call(this,az,aC,aB);alert(aC+" "+az.status+": "+aB+"\n\n"+mailsterL10n.check_console)},dataType:ar})}function v(ar){return R.trim(ar).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ah(){var aG,aC,ay,at,av,az=new Date(),ar=R(".time"),au=R(".deliverytime").eq(0),aB=R("#mailster_data_active"),aF=parseInt(ar.data("timestamp"),10)*1000,aE=false,aw=aF-az.getTime()+(az.getTimezoneOffset()*60000);var ax=(aE)?1000:20000;function aD(){aG=new Date();az=aG.getTime();aG.setTime(az+aw);ay=aG.getHours();at=aG.getMinutes();if(!f&&aC&&at!=aC[1]&&!aB.is(":checked")){au.val(aA(ay)+":"+aA(at))}aC=[];aC.push(aG.getHours());aC.push(aG.getMinutes());if(aE){aC.push(aG.getSeconds())}av=aC.length;for(var aH=0;aH<av;aH++){aC[aH]=aA(aC[aH])}ar.html(aC.join('<span class="blink">:</span>'));setTimeout(function(){aD()},ax)}function aA(aH){if(aH<10){aH="0"+aH}return aH}aD()}function x(){var ar=Array.prototype.slice.call(arguments),aw=ar.shift(),av=ar.length,au;for(var at=0;at<av;at++){au=new RegExp("%("+(at+1)+"\\$)?(s|d|f)");aw=aw.replace(au,ar[at])}return aw}function am(at,av){at=at.eq(0);if(at.is("img")&&at.attr("src")){var au=new Image(),ar;au.onload=function(){ar=((au.width/at.width()).toFixed(1)||1);if(av){av.call(this,au.width,au.height,isFinite(ar)?parseFloat(ar):1)}};au.src=at.attr("src")}}function r(au,at,ar,av){return(av===false?"":"#")+((1<<24)+(au<<16)+(at<<8)+ar).toString(16).slice(1)}if(document.selection&&document.selection.createRange){p=function(at,av,au){at.focus();at.select();var ar=document.selection.createRange();ar.collapse(true);ar.moveEnd("character",au);ar.moveStart("character",av);ar.select();return true}}else{p=function(ar,au,at){ar.selectionStart=au;ar.selectionEnd=at;return true}}if(window.getSelection){A=function(at){var av="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var au=document.activeElement.value;av=au.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ar=window.getSelection();av=ar.toString()}return av}}else{A=function(at){var au="";if(document.selection.createRange){var ar=document.selection.createRange();au=ar.text}return au}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px",marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"})};ak()});