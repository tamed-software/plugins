jQuery(document).ready(function(g){var p=g(window),h=false,j=g(".useit-nav"),C=g(".useit-tab"),q=g("#ID").val(),c=g("#form_form"),b=g("#form-builder"),y=g("#form-structure"),l=g("#form-fields");c.on("submit",function(){window.onbeforeunload=null});g("#use-it").on("click",function(){tb_show(mailsterL10n.useit,"#TB_inline?&width="+(Math.min(1200,p.width()-50))+"&height="+(p.height()-100)+"&inlineId=useitbox",null);if(h){alert(mailsterL10n.not_saved)}return false});j.on("click","a",function(){j.find("li").removeClass("active");C.hide();var F=g(this).parent().addClass("active").find("a").attr("href");g("#tab-"+F.substr(1)).show();return false});C.hide().eq(0).show();b.find(".sortable").sortable({containment:g("#form_form"),connectWith:".sortable",placeholder:"ui-state-highlight",start:function(F,G){b.addClass("dragging")},stop:function(F,G){b.removeClass("dragging")},receive:function(F,G){y.find("input").each(function(){g(this).attr("name",g(this).data("name"))});l.find("input").each(function(){g(this).removeAttr("name")})},update:function(F,G){E()},remove:function(F,G){}});y.on("click",".submitbutton input",function(F){F.preventDefault();g(this).focus().select()}).on("click",".field-remove",function(F){F.preventDefault();var G=g(this).parent().parent().parent();G.appendTo(l.find("ul"));G.find("input").removeAttr("name")});function E(){h=true;window.onbeforeunload=function(){return mailsterL10n.require_save}}var z="",n,d=g("input#style"),B=g(".add-custom-style"),f=g("#custom-style"),v=g("#custom-style-prefix"),D=g("#custom-style-samples"),o=g("#form-design-iframe"),r,i=g(".designnav"),u=g(".designtab"),m=g(".color-field"),A=g("[data-selector]");o.on("load",function(){n=g('<style id="mailster_form_preview_css"></style>').appendTo(o.contents().find("head"));x();o.contents().find("style.mailster-custom-form-css").remove()});B.on("click",function(){var G=g(this).parent().find(".color-field"),F=".mailster-form-"+q+" "+G.data("selector")+"{\n    \n}\n";f.val(f.val()+v.val()+F)});i.on("click","a.nav",function(){i.find("a").removeClass("nav-tab-active");u.hide();var F=g(this).addClass("nav-tab-active").attr("href");g("#"+F.substr(1)).show();return false}).find("a.nav").eq(0).trigger("click");m.wpColorPicker({clear:function(F,G){x()},change:function(F,G){clearTimeout(r);r=setTimeout(function(){x();E()},20)}});g("#themestyle").on("change",function(){o.attr("src",o.attr("src").replace(/&s=(1|0)/,"&s="+(g(this).prop("checked")?1:0)))});f.on("change",function(){x();E()});D.find("option").on("click",function(){f.val(f.val()+v.val()+".mailster-form-"+q+g(this).val()+"{\n    \n}\n");f[0].scrollTop=f[0].scrollHeight});g("#title").on("change",E);g("#form-builder").on("change","input",E);g("#form-options").on("change","input",E).on("change",".mailster_userschoice",function(){var F=g(this).is(":checked");g(this).parent().parent().parent().parent().find("legend.mailster_userschoice_td").hide().eq(F?1:0).show();g(this).parent().parent().find(".mailster_dropdown").prop("disabled",!F);g(this).parent().parent().parent().parent().find(".mailster_precheck").prop("disabled",(F?0:1))}).on("change","#redirect-cb",function(){g("#redirect-tf").prop("disabled",!g(this).is(":checked"))}).on("change",".double-opt-in",function(){(!parseInt(g(this).val(),10))?g("#double-opt-in-field").slideUp(200):g("#double-opt-in-field").slideDown(200)}).on("change",".vcard",function(){(g(this).is(":checked"))?g("#vcard-field").slideDown(200):g("#vcard-field").slideUp(200)});function x(){z="";var F={};g.each(A,function(){var K=g(this),G=K.data("selector"),I=K.data("property"),J=K.data("postfix")||"",H=K.val();if(!H){return}F[G]=F[G]||{};F[G][I]=H+J});g.each(F,function(G,H){z+="form.mailster-form.mailster-form-"+q+" "+G+"{\n";g.each(H,function(J,I){z+="\t"+J+": "+I+";\n"});z+="}\n"});z+=f.val().replace(/(<([^>]+)>)/ig,"");n.html(z);d.val(escape(JSON.stringify(F)));o[0].height=o[0].contentWindow.document.body.scrollHeight+"px"}var w=g(".button-options-wrap").find("input"),a=g(".button-preview"),k=g(".code-preview").find("textarea"),e=g(".shortcode-preview").find("input");w.on("change",t);g(".subscriber-button-style").on("change","input",t);k.on("click",function(){g(this).select()});e.on("click",function(){g(this).select()});g(".embed-form-input").on("change",function(){var H=g(this).parent().parent().parent(),F=H.find(".embed-form-input"),G=H.find(".embed-form-output");G.val(s(G.data("embedcode"),F.eq(0).val(),F.eq(1).val(),(F.eq(2).is(":checked")?"&style=1":"")))}).eq(0).trigger("change");g(".embed-form-output").on("focus",function(){g(this).select()});g(".form-output").on("focus",function(){g(this).select()});g(".nav-subscriber-button").on("click",function(){t()});function t(){var G=window.mailsterdata.embedcode,F=g("#ID").val(),H=g("#buttonwidth").val()||480,I="[newsletter_button id="+F,L=g("#showcount").prop("checked"),J=g("input[name=subscriber-button-style]:checked").val(),K=g("#ontop").prop("checked"),M=g("input[name=buttonlabel]:checked").val()=="custom",N=M?g("#buttonlabel").val():g("#buttonlabel").attr("placeholder");N=N?N.replace(/(<([^>]+)>)/ig,""):"";J=J+(K?" ontop":"");if(window.MailsterSubscribe&&window.MailsterSubscribe.loaded){window.MailsterSubscribe.destroy()}a.html("");G=G.replace("%ID%",F).replace("%SHOWCOUNT%",L?' data-showcount="1"':"").replace("%WIDTH%",H!=480?' data-width="'+H+'"':"").replace("%DESIGN%",J!="default"?' data-design="'+J+'"':"").replace("%LABEL%",N);a.html(G);k.val(G);if(J&&J!="default"){I+=' design="'+J+'"'}if(M){I+=' label="'+N+'"'}if(L){I+=' showcount="'+L+'"'}if(H!=480){I+=' width="'+H+'"'}I+="]";e.val(I)}function s(){var F=Array.prototype.slice.call(arguments),J=F.shift(),I=F.length,H;for(var G=0;G<I;G++){H=new RegExp("%("+(G+1)+"\\$)?(s|d|f)");J=J.replace(H,F[G])}return J}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px",marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"})}});